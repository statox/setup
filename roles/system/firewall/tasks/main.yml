# TODO Merge with roles/server/firewall/tasks/main.yml
# https://docs.ansible.com/ansible/latest/collections/community/general/ufw_module.html

- name: Install ufw
  apt:
    state: present
    name:
      - ufw
    update_cache: yes

- name: Allow ports
  ufw:
    rule: allow
    port: "{{ item }}"
  loop: "{{ open_ports }}"

- name: Allow outgoing
  ufw:
    direction: outgoing
    default: allow

- name: Deny incoming
  ufw:
    direction: incoming
    default: deny

- name: Deny routed
  ufw:
    direction: routed
    default: deny

- name: Enable ufw
  ufw:
    state: enabled
